FROM i386/debian:stretch

RUN echo 'deb-src http://deb.debian.org/debian stretch main' >> /etc/apt/sources.list
RUN echo 'deb-src http://security.debian.org/debian-security stretch/updates main' >> /etc/apt/sources.list
RUN echo 'deb-src http://deb.debian.org/debian stretch-updates main' >> /etc/apt/sources.list

RUN apt-get update
RUN apt-get -y build-dep wine
RUN apt-get -y install git llvm clang wget

RUN git clone https://github.com/tpoechtrager/osxcross /root/osxcross

COPY darwin/SDK/MacOSX10.8.sdk.tar.xz /root/osxcross/tarballs/

RUN cd /root/osxcross && UNATTENDED=1 ./build.sh

ENV PATH="/root/osxcross/target/bin:${PATH}"
ENV MACOSX_DEPLOYMENT_TARGET="10.8"

RUN mkdir -p /root/osxcross/target/macports
RUN printf "packages.macports.org" > /root/osxcross/target/macports/MIRROR

RUN osxcross-macports -32 fakeinstall -v pulseaudio
RUN osxcross-macports -32 install -v wine-devel
RUN osxcross-macports -32 install gnutls-dev
RUN env MACOSX_DEPLOYMENT_TARGET=10.12 osxcross-macports install MoltenVK


### Vulkan
WORKDIR /root/
RUN wget https://sdk.lunarg.com/sdk/download/1.1.92.1/mac/vulkansdk-macos-1.1.92.1.tar.gz
RUN tar -xvf vulkansdk-macos-1.1.92.1.tar.gz

WORKDIR /root/vulkansdk-macos-1.1.92.1/macOS
RUN mv Frameworks/vulkan.framework/ /root/osxcross/target/macports/pkgs/opt/local/Library/Frameworks/
RUN mv bin/* /root/osxcross/target/macports/pkgs/opt/local/bin/
RUN mv etc/* /root/osxcross/target/macports/pkgs/opt/local/etc/
RUN mv lib/pkgconfig/* /root/osxcross/target/macports/pkgs/opt/local/lib/pkgconfig/
RUN rmdir lib/pkgconfig/
RUN mv lib/* /root/osxcross/target/macports/pkgs/opt/local/lib/
RUN mv include/* /root/osxcross/target/macports/pkgs/opt/local/include/